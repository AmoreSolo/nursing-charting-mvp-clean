<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clinical Note Assistant</title>
  <style>
    :root{
      --bg:#f7f9fc; --card:#ffffff; --text:#0f172a; --muted:#64748b;
      --primary:#2563eb; --primary-press:#1e40af; --ring:#93c5fd;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--text); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:920px;margin:40px auto;padding:0 16px}
    .title{font-size:clamp(24px,3.2vw,36px);font-weight:800;letter-spacing:.2px;text-align:center;margin:6px 0 22px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 24px rgba(15,23,42,.06);padding:18px 18px}
    .label{font-size:14px;color:var(--muted);margin:12px 2px 8px}
    textarea{
      width:100%;min-height:140px;resize:vertical;border:1px solid #e2e8f0;border-radius:12px;
      padding:14px 12px;font:14px/1.55 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#fbfdff;
      outline:none; transition:border .15s, box-shadow .15s;
    }
    textarea:focus{border-color:var(--ring); box-shadow:0 0 0 4px rgba(147,197,253,.35)}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      min-width:180px;height:46px;border-radius:12px;border:none;cursor:pointer;
      color:#fff;background:var(--primary);font-weight:700;letter-spacing:.2px;
      box-shadow:0 10px 20px rgba(37,99,235,.25); transition:transform .05s ease, background .15s ease;
    }
    .btn:active{transform:translateY(1px); background:var(--primary-press)}
    .btn[disabled]{opacity:.7;cursor:not-allowed;transform:none;box-shadow:none}
    .stack{display:flex;flex-direction:column;gap:22px}
    .copy-row{display:flex;justify-content:center;margin-top:14px}
    .muted{color:var(--muted)}
    .error{color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;padding:12px 14px;border-radius:12px}
    .row{display:grid;gap:18px}
    @media (min-width:900px){ .row{grid-template-columns:1fr} }
    /* Spinner inside button */
    .spinner{
      width:16px;height:16px;border-radius:50%;
      border:2.5px solid rgba(255,255,255,.45); border-top-color:#fff;
      animation:spin .8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">Clinical Note Assistant</h1>

    <div class="card stack">
      <div>
        <div class="label">Input</div>
        <textarea id="input" placeholder="e.g., declined shower this morning; c/o feeling unwell; staff informed RN; safety maintained."></textarea>
      </div>

      <div class="row" style="justify-items:center">
        <button id="generate" class="btn">
          <span id="genLabel">Generate</span>
        </button>
      </div>

      <div>
        <div class="label">Output</div>
        <textarea id="output" readonly placeholder="—"></textarea>
        <div class="copy-row">
          <button id="copy" class="btn" type="button">Copy</button>
        </div>
      </div>

      <div>
        <div class="label">Educator Feedback</div>
        <textarea id="feedback" readonly placeholder="—"></textarea>
      </div>

      <div>
        <div class="label">Suggested Example (based on feedback)</div>
        <textarea id="example" readonly placeholder="—"></textarea>
      </div>

      <div id="err" class="error" style="display:none"></div>
      <div class="muted" style="text-align:center">Built for clarity and objectivity • Powered by <code>/api/chat</code></div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const btn = $("generate");
    const genLabel = $("genLabel");
    const input = $("input");
    const output = $("output");
    const feedback = $("feedback");
    const example = $("example");
    const err = $("err");
    const copyBtn = $("copy");

    function setLoading(isLoading){
      if(isLoading){
        btn.disabled = true;
        genLabel.textContent = "Generating…";
        const sp = document.createElement("span");
        sp.className = "spinner";
        sp.setAttribute("aria-hidden","true");
        if(!btn.querySelector(".spinner")) btn.appendChild(sp);
      }else{
        btn.disabled = false;
        genLabel.textContent = "Generate";
        const sp = btn.querySelector(".spinner");
        if(sp) sp.remove();
      }
    }

    async function callApi(note){
      const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ input: note })
      });
      if(!res.ok){
        const text = await res.text().catch(()=> "");
        throw new Error(`Server ${res.status}: ${text || res.statusText}`);
      }
      return res.json();
    }

    btn.addEventListener("click", async () => {
      err.style.display="none"; err.textContent="";
      output.value = ""; feedback.value = ""; example.value = "";
      const note = input.value.trim();
      if(!note){ err.textContent = "Please enter a brief input first."; err.style.display="block"; return; }
      try{
        setLoading(true);
        const data = await callApi(note);
        output.value   = data.note || "";
        feedback.value = data.feedback || "";
        example.value  = data.example || "";
      }catch(e){
        err.textContent = "Network error: " + e.message;
        err.style.display = "block";
      }finally{
        setLoading(false);
      }
    });

    copyBtn.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(output.value || "");
        copyBtn.textContent = "Copied!";
        setTimeout(()=> copyBtn.textContent = "Copy", 1200);
      }catch{
        copyBtn.textContent = "Failed";
        setTimeout(()=> copyBtn.textContent = "Copy", 1200);
      }
    });
  </script>
</body>
</html>
