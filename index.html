<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nursing Note Assistant</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --primary:#2563eb;
      --primary-pressed:#1e40af;
      --border:#e5e7eb;
      --radius:14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      max-width:920px;
      padding:28px 20px 48px;
      margin:0 auto;
    }

    header{
      text-align:center;
      margin:10px 0 26px;
    }
    h1{
      font-size: clamp(24px, 3.2vw, 34px);
      letter-spacing:.2px;
      margin:0 0 6px 0;
      font-weight:700;
    }
    .sub{
      color:var(--muted);
      font-size:14px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:0 6px 20px rgba(16,24,40,.06);
      padding:22px;
    }

    .stack{display:flex; flex-direction:column; gap:18px}

    .label{
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .sr-only{
      position:absolute !important;
      width:1px; height:1px;
      padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    textarea{
      width:100%;
      min-height:140px;
      resize:vertical;
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px 12px;
      line-height:1.5;
      font-size:15px;
      background:#fff;
      color:var(--text);
      outline:none;
      transition:border-color .15s ease;
    }
    textarea:focus{border-color:#c7d2fe; box-shadow:0 0 0 3px rgba(37,99,235,.12)}

    .center{display:flex; justify-content:center; margin-top:6px}

    button{
      cursor:pointer;
      border:0;
      border-radius:12px;
      padding:11px 20px;
      font-weight:600;
      background:var(--primary);
      color:#fff;
      transition:transform .02s ease, background .15s ease, box-shadow .15s ease;
      box-shadow:0 6px 16px rgba(37,99,235,.20);
    }
    button:active{transform:translateY(1px); background:var(--primary-pressed)}

    .output{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      min-height:96px;
      padding:14px 12px;
      font-size:15px;
      line-height:1.55;
      white-space:pre-wrap;
    }

    .hint{
      color:var(--muted);
      font-size:12px;
      margin-top:6px;
    }

    .error{
      color:#b91c1c;
      background:#fef2f2;
      border:1px solid #fecaca;
      border-radius:10px;
      padding:10px 12px;
      font-size:13px;
      white-space:pre-wrap;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Nursing Note Assistant</h1>
      <div class="sub">Refine quick notes into objective, resident-focused charting.</div>
    </header>

    <section class="card">
      <div class="stack">
        <!-- Input -->
        <label for="input" class="sr-only">Input</label>
        <div>
          <div class="label">Input</div>
          <textarea id="input" placeholder="e.g. refused shower this morning, c/o feeling unwell; staff offered assistance and warm washcloth"></textarea>
          <div class="hint">Tip: Keep it short. The assistant will expand to a clean nursing note.</div>
        </div>

        <div class="center">
          <button id="generate">Generate</button>
        </div>

        <!-- Output -->
        <div>
          <div class="label">Output</div>
          <div id="output" class="output">—</div>
        </div>

        <!-- Educator Feedback -->
        <div>
          <div class="label">Educator Feedback</div>
          <div id="feedback" class="output">—</div>
        </div>

        <div id="error" class="error" style="display:none"></div>
        <div class="hint">Built for clarity and objectivity — powered by <code>/api/chat</code>.</div>
      </div>
    </section>
  </div>

  <script>
    const btn = document.getElementById('generate');
    const inputEl = document.getElementById('input');
    const outEl = document.getElementById('output');
    const fbEl = document.getElementById('feedback');
    const errEl = document.getElementById('error');

    async function generate() {
      errEl.style.display = 'none';
      outEl.textContent = '…';
      fbEl.textContent = '…';

      const note = inputEl.value.trim();
      if (!note) {
        outEl.textContent = 'Please enter an input note.';
        fbEl.textContent = '—';
        return;
      }

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ input: note })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          throw new Error(data?.error || `Server error (${res.status})`);
        }

        // Expecting shape: { note: string, feedback: string }
        outEl.textContent = data?.note?.trim() || 'No note returned.';
        fbEl.textContent = data?.feedback?.trim() || '—';
      } catch (e) {
        outEl.textContent = '—';
        fbEl.textContent = '—';
        errEl.textContent = `Network error: ${e.message}`;
        errEl.style.display = 'block';
      }
    }

    btn.addEventListener('click', generate);

    // Optional: submit with Ctrl/Cmd+Enter
    inputEl.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
        generate();
      }
    });
  </script>
</body>
</html>
