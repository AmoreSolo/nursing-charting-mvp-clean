<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nursing Charting MVP</title>
  <style>
    :root { --blue:#1f6feb; --gray:#f3f4f6; --text:#111827; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:#ffffff; color:var(--text); }
    .wrap { max-width: 820px; margin: 48px auto; padding: 0 20px; }
    h1 { text-align: center; color: var(--blue); margin-bottom: 28px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 18px; }
    textarea { width: 100%; min-height: 160px; border: 1px solid #e5e7eb; border-radius: 10px; padding: 14px; font-size: 16px; outline: none; }
    textarea:focus { border-color: var(--blue); box-shadow: 0 0 0 3px rgba(31,111,235,.12); }
    .row { display: flex; gap: 12px; align-items: center; justify-content: center; margin: 18px 0; }
    button { background: var(--blue); color:#fff; border:none; padding:12px 20px; border-radius:10px; font-weight:600; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .label { font-weight: 600; margin: 10px 2px; }
    .out { white-space: pre-wrap; background: var(--gray); border: 1px solid #e5e7eb; padding: 14px; border-radius: 10px; min-height: 72px; }
    .err { color:#b91c1c; font-weight:600; }
    footer { margin-top: 28px; font-size: 12px; color:#6b7280; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Nursing Charting MVP</h1>

    <div class="card">
      <div class="label">Input (quick nursing note)</div>
      <textarea id="input" placeholder="e.g. Resident assisted with shower, tolerated well. Refused snack."></textarea>

      <div class="row">
        <button id="genBtn">Generate</button>
      </div>

      <div class="label">Output (AI nursing note)</div>
      <div id="note" class="out"></div>

      <div class="label">Educator Feedback</div>
      <div id="feedback" class="out"></div>

      <div id="error" class="label err"></div>
    </div>

    <footer>Built as minimal MVP • No API key required client-side • Powered by /api/chat</footer>
  </div>

  <script>
    const btn = document.getElementById('genBtn');
    const inputEl = document.getElementById('input');
    const noteEl = document.getElementById('note');
    const feedbackEl = document.getElementById('feedback');
    const errEl = document.getElementById('error');

    btn.addEventListener('click', async () => {
      errEl.textContent = '';
      noteEl.textContent = '';
      feedbackEl.textContent = '';

      const input = (inputEl.value || '').trim();
      if (!input) {
        errEl.textContent = 'Please enter a quick note first.';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Generating…';

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ input })
        });

        // Handle non-200 responses cleanly
        if (!res.ok) {
          const t = await res.text().catch(()=>'');
          throw new Error(t || `Server error (${res.status})`);
        }

        // Expect { note, feedback }
        const data = await res.json();

        // Backward/fallbacks if server returns a single string
        if (typeof data === 'string') {
          noteEl.textContent = data;
        } else {
          noteEl.textContent = data.note || '';
          feedbackEl.textContent = data.feedback || '';
        }
      } catch (e) {
        errEl.textContent = `Network error: ${e.message || e}`;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Generate';
      }
    });
  </script>
</body>
</html>
